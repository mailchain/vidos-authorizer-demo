# Project Context

## Purpose
Vidos Authorizer Demo is a reference implementation demonstrating how the Vidos Authorizer service can be used to verify credentials in OpenID4VP (OID4VP)-based flows. The application showcases credential verification scenarios including:
- Standard OID4VP flows using QR codes
- Digital Credentials API (DC API) flows using browser-native credential exchange
- Multiple credential formats (SD-JWT and mDoc/ISO mdoc)
- Real-time authorization status polling and policy evaluation

**Key Goals:**
- Demonstrate Vidos Authorizer integration patterns
- Support multiple credential types (PID, MDL, Photo ID)
- Showcase both direct_post and dc_api response modes
- Provide a reusable reference for developers implementing credential verification

## Tech Stack
- **Runtime:** Bun (package manager & runtime)
- **Framework:** React 19 with TypeScript (strict mode)
- **Build Tool:** Vite 7
- **Styling:** Tailwind CSS v4 (Vite plugin, not PostCSS)
- **UI Components:** shadcn/ui (new-york variant)
- **State Management:** Zustand for flow state + React Query for server state
- **API Client:** openapi-fetch (type-safe, generated from OpenAPI spec)
- **Code Quality:** Biome (linting & formatting)
- **Validation:** Zod
- **QR Codes:** qrcode.react
- **Icons:** lucide-react

## Project Conventions

### Code Style
**Enforced by Biome:**
- Indentation: Tabs (not spaces)
- Quotes: Double quotes
- Organize imports automatically on save

**TypeScript:**
- Strict mode enabled
- Target: ES2022
- No unused locals or parameters
- Bundler module resolution
- Path alias: `@/*` maps to `src/*` (via vite-tsconfig-paths)

**Naming Conventions:**
- Components: PascalCase (e.g., `CredentialRequestBuilder.tsx`)
- Hooks: camelCase with `use` prefix (e.g., `useFlowStore.ts`)
- Utilities: camelCase (e.g., `queryBuilder.ts`)
- Types: PascalCase for interfaces/types
- Constants: UPPER_SNAKE_CASE for exported constants

### Architecture Patterns
**Three-Stage Authorization Flow:**
1. **Create Stage** - Configure authorizer URL, build credential requests, select response mode
2. **Authorization Stage** - Present QR code or invoke DC API, poll for status
3. **Result Stage** - Display authorization outcome and policy evaluation results

**State Management:**
- Zustand store (`useFlowStore`) for flow state (stage, requests, config)
- React Query for server state (authorization status polling, policy responses)
- localStorage for persisting authorizer URL configuration

**API Client Pattern:**
- OpenAPI spec → `openapi-typescript` → type-safe client
- Auto-generated types in `src/api/authorizer.ts`
- Custom client factory in `src/api/client.ts`
- Regenerate via `bun run generate-api:local` or `generate-api:prod`

**DCQL Query Building:**
- Credential requests → DCQL queries via `queryBuilder.ts`
- Format-specific handling (SD-JWT uses `vct`, mDoc uses `doctype` + `namespace`)

**Response Modes:**
- `direct_post` / `direct_post.jwt` - Standard OID4VP (QR code)
- `dc_api` / `dc_api.jwt` - Digital Credentials API (browser native)
- DC API requires HTTPS and modern browser support

### Testing Strategy
No formal testing framework currently implemented. Testing is manual via:
- Type checking: `bun run type-check`
- Linting: `bun run lint`
- Build verification: `bun run build`

### Git Workflow
- Repository: https://github.com/mailchain/vidos-authorizer-demo
- Standard GitHub flow (feature branches → main)
- Commits should be descriptive and focused

## Domain Context

### OpenID4VP (OpenID for Verifiable Presentations)
Protocol for requesting and presenting verifiable credentials. This app implements the verifier/relying party side using Vidos Authorizer as the backend service.

### Credential Formats
**SD-JWT (Selective Disclosure JWT):**
- Format identifier: `dc+sd-jwt`
- Uses `vct` (verifiable credential type) for identification
- Claims specified via JSONPath arrays
- Example: `urn:eu.europa.ec.eudi:pid:1`

**mDoc (ISO/IEC 18013-5 mobile documents):**
- Format identifier: `mso_mdoc`
- Uses `doctype` + `namespace` for identification
- Claims specified via namespace + element identifier
- Example: `org.iso.18013.5.1.mDL` with namespace `org.iso.18013.5.1`

### Credential Cases
Pre-defined credential types with format mappings:
- **PID** (Person Identification Data) - EU digital identity credential
- **MDL** (Mobile Driving Licence) - ISO 18013-5 standard
- **Photo ID** - Simple photo identification credential
- **Custom Cases** - User-defined credential types (stored in localStorage)

### DCQL (Digital Credentials Query Language)
Query format for requesting credentials. Generated by `queryBuilder.ts` from credential requests.

### Digital Credentials API (DC API)
Browser-native API (`navigator.credentials.get()`) for credential exchange:
- Requires HTTPS
- Supports signed (`openid4vp-v1-signed`) and unsigned (`openid4vp-v1-unsigned`) protocols
- Signed mode requires `expectedOrigins` array
- Browser support varies (check via `checkDCAPISupport()`)

## Important Constraints

**Browser Requirements:**
- DC API flows require modern browsers with Digital Credentials API support
- HTTPS required for DC API (localhost exempt for development)
- QR code flows work in all modern browsers

**API Dependencies:**
- Requires valid Vidos Authorizer service endpoint
- Authorizer URL must be HTTPS (or http://localhost for dev)
- OpenAPI spec must match authorizer service version

**Format Limitations:**
- MDL only supports mDoc format (not SD-JWT)
- Different credential formats have different attribute paths
- Custom credential cases must follow format-specific schemas

**Build Configuration:**
- Base path: `/vidos-authorizer-demo/` (for GitHub Pages deployment)
- Type checking runs before production builds
- Generated API types should not be manually edited

## External Dependencies

**Vidos Services:**
- **Vidos Authorizer** - Backend credential verification service
  - Endpoint: Configurable (e.g., `https://vidos.id/authorizer`)
  - OpenAPI spec: `https://vidos.id/docs/spec/openapi/authorizer.service.yaml`
- **Vidos Dashboard** - Service creation/management: https://dashboard.vidos.id
- **Vidos Gateway** - Optional gateway integration (see GATEWAY_SETUP.md)

**Documentation:**
- Main site: https://vidos.id
- Docs: https://docs.vidos.id
- GitHub: https://github.com/mailchain/vidos-authorizer-demo

**UI Components:**
- shadcn/ui components (Radix UI primitives)
- Tailwind CSS v4 (using Vite plugin)
- Custom components in `src/components/ui/`

**Type Generation:**
- openapi-typescript for API client generation
- Requires valid OpenAPI spec (local or remote)
